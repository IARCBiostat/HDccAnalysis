% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sim_cox_age_data_helpers.R
\name{.simulate_one}
\alias{.simulate_one}
\title{Simulate a single subject's event time under piecewise-constant hazard}
\usage{
.simulate_one(entry_age, censor_age, exp_eta, lookup_table)
}
\arguments{
\item{entry_age}{Numeric scalar giving the subject's age at study entry.}

\item{censor_age}{Numeric scalar giving the administrative censoring age.
Must satisfy \code{censor_age > entry_age}.}

\item{exp_eta}{Positive scalar equal to \eqn{\exp(\eta)}, the
subject-specific hazard multiplier.}

\item{lookup_table}{List produced by \code{.prep_lookup()}, containing
numeric vectors \code{lo}, \code{hi}, and \code{rate} defining the
attained-age baseline hazard bands.}
}
\value{
A list with components:
\describe{
\item{age_exit}{Numeric scalar giving the exit age (event or censoring).}
\item{event}{Integer scalar equal to 1 if an event occurred and 0 if
administratively censored.}
}
}
\description{
Simulates an event time for one subject followed from entry age
\code{entry_age} to administrative censoring age \code{censor_age}
under an attained-age baseline hazard that is piecewise constant over
age bands. The subject-specific hazard is
\deqn{
  h(a) = h_0(a) \exp(\eta),
}
where \code{exp_eta = exp(eta)} is the Cox proportional hazards multiplier.
}
\details{
The simulation proceeds band-by-band. At the current attained age
\code{current_age}, the baseline hazard \eqn{h_0(a)} is obtained
from the age band containing that age. A waiting time is drawn from an
exponential distribution with rate
\code{h_0(a) * exp_eta}. If the waiting time occurs before the end
of the current age band (or before \code{censor_age}), an event occurs.
Otherwise the subject advances to the next band boundary and the procedure
repeats until \code{censor_age}.

Age bands are treated as left-closed, right-open intervals:
\code{[age_lo, age_hi)}. An attained age equal to \code{age_hi} is assigned
to the next band.

The baseline hazard must be defined for all attained ages reachable in
\code{[entry_age, censor_age)}. If no age band contains the current
attained age, the function errors.

The method is exact for piecewise-constant hazards because within each
age band the hazard is constant and the waiting time distribution is
exponential.
}
\examples{
lk <- list(
  lo = c(50, 60),
  hi = c(60, 70),
  rate = c(0.01, 0.02)
)

set.seed(1)
.simulate_one(entry_age = 55,
              censor_age = 65,
              exp_eta = 1.5,
              lookup_table = lk)
}
